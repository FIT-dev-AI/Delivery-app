<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery App API Tester</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b35;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55a2b;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .endpoint-info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Delivery App API Tester</h1>
        <p><strong>Base URL:</strong> <code>http://192.168.1.5:3000/api</code></p>
        
        <!-- Server Status -->
        <div class="test-section">
            <h3>‚ù§Ô∏è Server Status</h3>
            <button onclick="testServerStatus()">Check Server</button>
            <div id="server-result" class="result"></div>
        </div>
        
        <!-- Authentication -->
        <div class="test-section">
            <h3>üîê Authentication</h3>
            <div class="endpoint-info">POST /api/auth/register</div>
            <input type="text" id="reg-name" placeholder="T√™n" value="Test User">
            <input type="email" id="reg-email" placeholder="Email" value="webtest@example.com">
            <input type="password" id="reg-password" placeholder="M·∫≠t kh·∫©u" value="123456">
            <input type="text" id="reg-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" value="0123456789">
            <select id="reg-role">
                <option value="customer">Customer</option>
                <option value="shipper">Shipper</option>
                <option value="admin">Admin</option>
            </select>
            <button onclick="testRegister()">Register</button>
            
            <div class="endpoint-info">POST /api/auth/login</div>
            <input type="email" id="login-email" placeholder="Email" value="webtest@example.com">
            <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" value="123456">
            <button onclick="testLogin()">Login</button>
            
            <div id="auth-result" class="result"></div>
        </div>
        
        <!-- Orders -->
        <div class="test-section">
            <h3>üì¶ Orders Management</h3>
            <div class="endpoint-info">GET /api/orders</div>
            <button onclick="testGetOrders()">Get Orders</button>
            
            <div class="endpoint-info">POST /api/orders</div>
            <input type="text" id="pickup-address" placeholder="ƒê·ªãa ch·ªâ l·∫•y h√†ng" value="123 Nguy·ªÖn VƒÉn A, Q1, HCM">
            <input type="text" id="delivery-address" placeholder="ƒê·ªãa ch·ªâ giao h√†ng" value="456 Tr·∫ßn H∆∞ng ƒê·∫°o, Q5, HCM">
            <button onclick="testCreateOrder()">Create Order</button>
            
            <div id="orders-result" class="result"></div>
        </div>
        
        <!-- Statistics -->
        <div class="test-section">
            <h3>üìä Statistics</h3>
            <div class="endpoint-info">GET /api/stats/dashboard</div>
            <button onclick="testGetStats()">Get Statistics</button>
            <div id="stats-result" class="result"></div>
        </div>
        
        <!-- Token Display -->
        <div class="test-section">
            <h3>üîë Current Token</h3>
            <textarea id="current-token" rows="3" readonly placeholder="Token s·∫Ω hi·ªÉn th·ªã sau khi login..."></textarea>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://192.168.1.5:3000/api';
        let currentToken = '';
        
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }
        
        async function testServerStatus() {
            try {
                const response = await fetch('http://192.168.1.5:3000');
                showResult('server-result', '‚úÖ Server ƒëang ch·∫°y v√† c√≥ th·ªÉ truy c·∫≠p', 'success');
            } catch (error) {
                if (error.message.includes('Failed to fetch')) {
                    showResult('server-result', '‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server. Ki·ªÉm tra:\n1. Server c√≥ ƒëang ch·∫°y?\n2. Firewall c√≥ block port 3000?\n3. IP address c√≥ ƒë√∫ng?', 'error');
                } else {
                    showResult('server-result', `‚ùå L·ªói: ${error.message}`, 'error');
                }
            }
        }
        
        async function testRegister() {
            const data = {
                name: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-password').value,
                phone: document.getElementById('reg-phone').value,
                role: document.getElementById('reg-role').value
            };
            
            try {
                const response = await fetch(`${BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('auth-result', `‚úÖ Register th√†nh c√¥ng: ${result.message}`, 'success');
                } else {
                    showResult('auth-result', `‚ùå Register l·ªói: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('auth-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function testLogin() {
            const data = {
                email: document.getElementById('login-email').value,
                password: document.getElementById('login-password').value
            };
            
            try {
                const response = await fetch(`${BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    currentToken = result.token;
                    document.getElementById('current-token').value = currentToken;
                    showResult('auth-result', `‚úÖ Login th√†nh c√¥ng!\nUser: ${result.user.name} (${result.user.role})\nToken: ${currentToken.substring(0, 50)}...`, 'success');
                } else {
                    showResult('auth-result', `‚ùå Login l·ªói: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('auth-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function testGetOrders() {
            if (!currentToken) {
                showResult('orders-result', '‚ùå C·∫ßn login tr∆∞·ªõc khi test orders', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${BASE_URL}/orders`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('orders-result', `‚úÖ Get orders th√†nh c√¥ng!\nS·ªë l∆∞·ª£ng: ${result.data?.length || 0}\nData: ${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('orders-result', `‚ùå Get orders l·ªói: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('orders-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function testCreateOrder() {
            if (!currentToken) {
                showResult('orders-result', '‚ùå C·∫ßn login tr∆∞·ªõc khi t·∫°o order', 'error');
                return;
            }
            
            const data = {
                pickup_lat: 10.762622,
                pickup_lng: 106.660172,
                pickup_address: document.getElementById('pickup-address').value,
                delivery_lat: 10.772431,
                delivery_lng: 106.698265,
                delivery_address: document.getElementById('delivery-address').value
            };
            
            try {
                const response = await fetch(`${BASE_URL}/orders`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}` 
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('orders-result', `‚úÖ Create order th√†nh c√¥ng!\nOrder ID: ${result.data?.id}\nStatus: ${result.data?.status}\nData: ${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('orders-result', `‚ùå Create order l·ªói: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('orders-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        async function testGetStats() {
            if (!currentToken) {
                showResult('stats-result', '‚ùå C·∫ßn login tr∆∞·ªõc khi xem stats', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${BASE_URL}/stats/dashboard`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const result = await response.json();
                if (result.success) {
                    showResult('stats-result', `‚úÖ Get stats th√†nh c√¥ng!\nData: ${JSON.stringify(result.data, null, 2)}`, 'success');
                } else {
                    showResult('stats-result', `‚ùå Get stats l·ªói: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult('stats-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }
        
        // Auto test server status on load
        window.onload = function() {
            testServerStatus();
        };
    </script>
</body>
</html>
